


# Api
[Jump to api index.](#index)
## A (rich) promise in return...
Every api method returns a [Bluebird][1] promise, decorated with the following properties:

- **query** The cypher query to serve to the Neo4j HTTP server
- **originalQuery** The cypher query generated by the neo4acl lib. The query identifiers are not replaced with those you may provide in the configuration objects
- **parameters** An object containing the parameters to serve with the cypher query
- **parser** A function which takes a callback as parameter. Returns a function that, if called with the **db query results**, will call the callback with the **api results**. (Useful for multi queries transactions)
- **execute** A function which triggers the query to the database and returns the promise itself.

The returned promise is *inactivated* by default, meanig that the following call:

```javacript
var richpromise = acl.getUserGroups('giacomo');

```
will not trigger any query to the database. 

Being a promise, you can let `richpromise` *fly away* somewhere in your code.
It will never be resolved or rejected untill you call
```javascript
richpromise.execute()
```

This will trigger the query to the db, process the query results, and resolve the promise with the Api result or reject it with an error from the db (if any).

The promise can be *executed* just once. Any subsequent call to `richpromise.execute()`will not query the db and just return the promise itself.

If you want that the api method immediately fires a query when you call it, just pass a callback as last parameter.
So

```javascript
var richpromise = acl.getUserGroups('giacomo', function(err, groups) {});
```
will immediately query the database.
The passed callback receives an eventual error from the db and the **api result**.
**NOTE: in the example above 'groups' is not the direct result of the db query, but the value returned after the db result processing.**

`richpromise` remains a promise which will be resolved or rejected.
```javascript
richpromise.then(function(groups) {
    // groups here is === to the groups variable passed to the callback in the previous example
});
```
## ... is useful for transaction purposes.
I hear you...
"...what if you could make acl queries as part of a wider transaction?"

**Here you are!**

The `query` and `parameters` property of every api call result are tought to be exploited in a multi query transaction scenario.

For example:
```javascript
var seraph = require('seraph');
var neo4j = seraph();

var acl = require('neo4acl')();

var create_giacomo_user = 'MERGE (user:User {_id:\'giacomo\'}) RETURN user';
var put_user_in_groups = acl.addUserToGroups('giacomo', ['user_giacomo', 'males']);
var get_user_groups = acl.getUserGroups('giacomo');

var txn = neo4j.batch();

    txn.query(create_giacomo_user);
    txn.query(put_user_in_groups.query, put_user_in_groups.parameters);
    txn.query(get_user_groups.query, get_user_groups.parameters, get_user_groups.parser(function(err, groups) {
        // 'groups' is an api result
    }));
    
    txn.commit();

```
[Jump to top.](#api)
## Index


[acl.addUserToGroups()](#acladdusertogroups-user_id-groups-cberr-done-)

[acl.removeUserFromGroups()](#aclremoveuserfromgroups-user_id-groups-cberr-done-)

[acl.getUserGroups()](#aclgetusergroups-user_id-cberr-groups-)

[acl.isUserInAllGroups()](#isUserInAllGroups)

[acl.isUserInAnyGroup()](#isUserInAnyGroup)

[acl.addGroupParents()](#addGroupParents)

[acl.removeGroup()](#removeGroup)

[acl.removeResource()](#removeResource)

[acl.giveResourcesPermissions()](#giveResourcesPermissions)

[acl.denyResourcesPermission()](#denyResourcesPermission)

[acl.getResourcesPermissions()](#getResourcesPermissions)

[acl.isAllowed()](#isAllowed)

[acl.isAllowedAny()](#isAllowedAny)

[acl.areAnyGroupsAllowed()](#areAnyGroupsAllowed)

----------

### acl.addUserToGroups( user_id, groups, cb(err, done) )
Parameters:

- **user_id** {String || Number} User id
- **groups** {String || [String, ...]} Group(s)
- **cb** {Function} [optional]
	- **err** {Object} A Neo4j REST API Layer error
	- **done** {Boolean}

Ad the user to the listed groups.
***
[Jump to top.](#api) -  [Jump to index.](#index) 
***
### acl.removeUserFromGroups( user_id, groups, cb(err, done) )
Parameters:

- **user_id** {String || Number} User id
- **groups** {String || [String, ...]} Group(s)
- **cb** {Function} [optional]
	- **err** {Object} A Neo4j REST API Layer error
	- **done** {Boolean}

Removes the user from the listed groups.
***
[Jump to top.](#api) -  [Jump to index.](#index) 
***
### acl.getUserGroups( user_id, cb(err, groups) )
Parameters:

- **user_id** {String || Number} User id
- **cb** {Function} [Optional]
    - **err** {Object} A Neo4j REST API Layer error
    - **groups** {Array} The list of groups the user belongs to
```javascript
        groups = [
                    {
                        name: 'Role name',
                        distance: 1
                    },
                    {...}
                ] 
```
Returns an array of the groups the user belongs to.

For each group, the ```distance``` property tells if the user is a direct member of the group (if ```distance === 1```) or if she's N groups away.
***
[Jump to top.](#api) -  [Jump to index.](#index) 
***
### <a id="isUserInAllGroups"></a>acl.isUserInAllGroups( user_id, groups, cb(err, bool) )
Parameters:

- **user_id** {String || Number} User id 
- **groups** {String || [String, ...]} Group(s)
- **cb** {Function} [Optional]
    - **err** {Object} A Neo4j REST API Layer error
    - **bool** {Boolean}

Checks if the user belongs to each of the listed groups
***
[Jump to top.](#api) -  [Jump to index.](#index) 
***
### <a id="isUserInAnyGroup"></a>acl.isUserInAnyGroup( user_id, groups, cb(err, bool) )
Parameters:

- **user_id** {String || Number} User id 
- **groups** {String || [String, ...]} Group(s)
- **cb** {Function} [Optional]
    - **err** {Object} A Neo4j REST API Layer error
    - **bool** {Boolean}

Checks if the user belongs to any of the listed groups
***
[Jump to top.](#api) -  [Jump to index.](#index) 
***
### <a id="addGroupParents"></a>acl.addGroupParents( group, parents, cb(err, done) )
Parameters:

- **group** {String} Group
- **parents** {String || [String, ...]} Parent(s)
- **cb** {Function} [Optional]
    - **err** {Object} A Neo4j REST API Layer error
    - **done** {Boolean}

Set the given group as belonging to the listed parent groups.
***
[Jump to top.](#api) -  [Jump to index.](#index) 
***
### <a id="removeGroup"></a>acl.removeGroup( group, cb(err, done) )
Parameters:

- **group** {String} Group
- **cb** {Function} [Optional]
    - **err** {Object} A Neo4j REST API Layer error
    - **done** {Boolean}

Removes the group and all it's permissions from the system.
***
[Jump to top.](#api) -  [Jump to index.](#index) 
***
### <a id="removeResource"></a>acl.removeResource( resource_name, cb(err, done) )
Parameters:

- **resource_name** {String} Resource name
- **cb** {Function} [Optional]
    - **err** {Object} A Neo4j REST API Layer error
    - **done** {Boolean}

Removes the resource from the system.
***
[Jump to top.](#api) -  [Jump to index.](#index) 
***
### <a id="giveResourcesPermissions"></a>acl.giveResourcesPermissions( groups, resources, permissions, cb(err, done) )
Parameters:

- **groups** {String || [String, ...]} Group(s)
- **resources** {String || [String, ...]} Resource(s)
- **permissions** {String || [String, ...] Permission(s)
- **cb** {Function} [Optional]
    - **err** {Object} A Neo4j REST API Layer error
    - **done** {Boolean}

Gives to the listed groups the listed permissions over the listed resources.
***
[Jump to top.](#api) -  [Jump to index.](#index) 
***
### <a id="denyResourcesPermission"></a>acl.denyResourcesPermission( groups, resources, permissions, cb(err, done) )
Parameters:

- **groups** {String || [String, ...]} Group(s)
- **resources** {String || [String, ...]} Resource(s)
- **permissions** {String || [String, ...] Permission(s)
- **cb** {Function} [Optional]
    - **err** {Object} A Neo4j REST API Layer error
    - **done** {Boolean}

Removes the listed permissions over the listed resources from the listed groups.
***
[Jump to top.](#api) -  [Jump to index.](#index) 
***
### <a id="getResourcesPermissions"></a>acl.getResourcesPermissions( user_id, resources, cb(err, resources) )
Parameters:

- **user_id** {String || Number} User id
- **resources** {String || [String, ...]} Resource(s)
- **cb** {Function} [Optional]
    - **err** {Object} A Neo4j REST API Layer error
    - **resources** {Array}
```javascript
        resources = [
                        {
                            name: 'Resource name',
                            permissions: [String, ...]
                        },
                        {...}
                    ]
```
Checks the permissions a user has over the listed resources.
Returns an array of resources.
***
[Jump to top.](#api) -  [Jump to index.](#index) 
***
### <a id="isAllowed"></a>acl.isAllowed( user_id, resources, permissions, cb(err, allowed) )
Parameters:

- **user_id** {String || Number} User id
- **resources** {String || [String, ...]} Resource(s)
- **permissions** {String || [String, ...] Permission(s)
- **cb** {Function} [Optional]
    - **err** {Object} A Neo4j REST API Layer error
    - **allowed** {Boolean}

Checks if the user has ALL the listed permissions over all the listed resources.
***
[Jump to top.](#api) -  [Jump to index.](#index) 
***
### <a id="isAllowedAny"></a>acl.isAllowedAny(user_id, resources, permissions, cb(err, allowed) )
Parameters:

- **user_id** {String || Number} User id
- **resources** {String || [String, ...]} Resource(s)
- **permissions** {String || [String, ...] Permission(s)
- **cb** {Function} [Optional]
    - **err** {Object} A Neo4j REST API Layer error
    - **allowed** {Boolean}

For each of the listed resources, checks if the user has ANY of the listed permission.
***
[Jump to top.](#api) -  [Jump to index.](#index) 
***
### <a id="areAnyRolesAllowed"></a>acl.areAnyRolesAllowed( groups, resources, permissions, callback(err, allowed) )
Parameters:

- **groups** {String || [String, ...]} Group(s)
- **resources** {String || [String, ...]} Resource(s)
- **permissions** {String || [String, ...] Permission(s)
- **cb** {Function} [Optional]
    - **err** {Object} A Neo4j REST API Layer error
    - **allowed** {Boolean}

Checks if any of the listed groups has ALL the listed permissions over all the listed resources.


  [1]: https://github.com/petkaantonov/bluebird
  [2]: http://promisesaplus.com/#terminology